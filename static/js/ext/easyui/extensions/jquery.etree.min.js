!function(e){e.fn.etree=function(t,r){if("string"==typeof t){var n=e.fn.etree.methods[t];return n?n(this,r):this.tree(t,r)}return t=t||{},this.each(function(){var r,n,o=e.data(this,"etree");o?e.extend(o.options,t):e.data(this,"etree",{options:e.extend({},e.fn.etree.defaults,e.fn.etree.parseOptions(this),t)}),r=this,n=e.data(r,"etree").options,e(r).tree(e.extend({},n,{onDblClick:function(t){e(this).tree("beginEdit",t.target)},onBeforeEdit:function(t){if(0==n.onBeforeEdit.call(r,t))return!1;e(this).tree("disableDnd")},onAfterEdit:function(t){e.ajax({url:n.updateUrl,type:"post",dataType:"json",data:{id:t.id,text:t.text}}),e(this).tree("enableDnd"),n.onAfterEdit.call(r,t)},onCancelEdit:function(t){e(this).tree("enableDnd"),n.onCancelEdit.call(r,t)},onDrop:function(t,o,d){var i=e(r).tree("getNode",t).id;e.ajax({url:n.dndUrl,type:"post",dataType:"json",data:{id:o.id,targetId:i,point:d}}),n.onDrop.call(r,t,o,d)}}))})},e.fn.etree.methods={options:function(t){return e.data(t[0],"etree").options},create:function(t){return t.each(function(){var t=e.data(this,"etree").options,r=e(this),n=r.tree("getSelected");e.ajax({url:t.createUrl,type:"post",dataType:"json",data:{parentId:n?n.id:0},success:function(e){r.tree("append",{parent:n?n.target:null,data:[e]})}})})},edit:function(t){return t.each(function(){var t=e.data(this,"etree").options,r=e(this).tree("getSelected");r?e(this).tree("beginEdit",r.target):e.messager.show({title:t.editMsg.norecord.title,msg:t.editMsg.norecord.msg})})},destroy:function(t){return t.each(function(){var t=e.data(this,"etree").options,r=e(this),n=r.tree("getSelected");n?e.messager.confirm(t.destroyMsg.confirm.title,t.destroyMsg.confirm.msg,function(o){o&&(t.destroyUrl?e.post(t.destroyUrl,{id:n.id},function(){r.tree("remove",n.target)}):r.tree("remove",n.target))}):e.messager.show({title:t.destroyMsg.norecord.title,msg:t.destroyMsg.norecord.msg})})}},e.fn.etree.parseOptions=function(t){var r=e(t);return e.extend({},e.fn.tree.parseOptions(t),{createUrl:r.attr("createUrl")?r.attr("createUrl"):void 0,updateUrl:r.attr("updateUrl")?r.attr("updateUrl"):void 0,destroyUrl:r.attr("destroyUrl")?r.attr("destroyUrl"):void 0,dndUrl:r.attr("dndUrl")?r.attr("dndUrl"):void 0})},e.fn.etree.defaults=e.extend({},e.fn.tree.defaults,{editMsg:{norecord:{title:"Warning",msg:"No node is selected."}},destroyMsg:{norecord:{title:"Warning",msg:"No node is selected."},confirm:{title:"Confirm",msg:"Are you sure you want to delete?"}},dnd:!0,url:null,createUrl:null,updateUrl:null,destroyUrl:null,dndUrl:null})}(jQuery);